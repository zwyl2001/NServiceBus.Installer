<!DOCTYPE html>
<!-- saved from url=(0057)http://particular.net/blog/nservicebus-v4.0-release-notes -->
<html lang="en-US" class="dyn contents"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <meta charset="utf-8">
    <title>Particular Software | Enterprise-Grade Service Platform for .NET - NServiceBus V4.0 release notes</title> 
    <link href="./NServiceBus V4.0 release notes_files/orchard-localization-base.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/Site.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/carrousel.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/jquery.fancybox.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/Content.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/Content2.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/Content3.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/orchard-search-search.css" rel="stylesheet" type="text/css">
<link href="./NServiceBus V4.0 release notes_files/orchard-blogs-archives.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./NServiceBus V4.0 release notes_files/pd.js"></script><script type="text/javascript" src="./NServiceBus V4.0 release notes_files/pd.js"></script><script type="text/javascript" async="" src="./NServiceBus V4.0 release notes_files/ga.js"></script><script src="./NServiceBus V4.0 release notes_files/jquery-1.8.2.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="/Core/Shapes/Scripts/html5.js" type="text/javascript"></script>
<![endif]-->
<meta content="Orchard" name="generator">
<meta content="IE=edge,chrome=1" name="X-UA-Compatible">
<link href="http://particular.net/Media/Default/favicon/32x32.ico" rel="shortcut icon" type="image/x-icon">
<script type="text/javascript">
var _gaq=_gaq||[];
_gaq.push(["_setAccount","UA-20451773-2"]);
_gaq.push(["_setDomainName","Particular.net"]);
_gaq.push(["_setAllowHash",false]);
_gaq.push(["_trackPageview"]);
(function() {
	var ga=document.createElement("script");ga.type="text/javascript";ga.async=true;
	ga.src=(("https:" == document.location.protocol)?"https://ssl":"http://www")+".google-analytics.com/ga.js";
	var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);
})();
</script>


<link rel="alternate" type="application/rss+xml" title="Blog" href="http://particular.net/rss?containerid=231">
<link rel="alternate" type="application/rss+xml" title="Blog - Comments" href="http://particular.net/rss?commentedoncontainer=231">
    <script>(function(d){d.className="dyn"+d.className.substring(6,d.className.length);})(document.documentElement);</script> 
<script src="./NServiceBus V4.0 release notes_files/j.php" type="text/javascript"></script><link rel="stylesheet" type="text/css" href="./NServiceBus V4.0 release notes_files/default.css"><link rel="stylesheet" type="text/css" href="./NServiceBus V4.0 release notes_files/prettify.css"><style>[touch-action="none"]{ -ms-touch-action: none; touch-action: none; }[touch-action="pan-x"]{ -ms-touch-action: pan-x; touch-action: pan-x; }[touch-action="pan-y"]{ -ms-touch-action: pan-y; touch-action: pan-y; }[touch-action="scroll"],[touch-action="pan-x pan-y"],[touch-action="pan-y pan-x"]{ -ms-touch-action: pan-x pan-y; touch-action: pan-x pan-y; }</style><script type="text/javascript" src="./NServiceBus V4.0 release notes_files/analytics"></script><script type="text/javascript" src="./NServiceBus V4.0 release notes_files/analytics"></script><script type="text/javascript" src="./NServiceBus V4.0 release notes_files/analytics(1)"></script><script type="text/javascript" src="./NServiceBus V4.0 release notes_files/analytics(1)"></script></head> 
<body>


<div class="aside-2" id="layout-wrapper">
<link href="./NServiceBus V4.0 release notes_files/css" rel="stylesheet" type="text/css">



<div class="container">
        <div class="logo">
            <div class="zone zone-header">
<article class="widget-header widget-html-widget widget">
    
<div><a href="http://particular.net/"><img alt="logo" src="./NServiceBus V4.0 release notes_files/logo.png"></a></div>
<!-- begin Pardot Website Tracking code --><script type="text/javascript">
piAId = '28442';
piCId = '78324';
(function() {
	function async_load(){
		var s = document.createElement('script'); s.type = 'text/javascript';
		s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
		var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
	}
	if(window.attachEvent) { window.attachEvent('onload', async_load); }
	else { window.addEventListener('load', async_load, false); }
})();
</script><!-- end Pardot Website Tracking code -->
</article></div>
        </div>
            <div class="navigation">
            <div class="zone zone-navigation">
<article class="widget-main-menu widget-navigation widget-menu-widget widget">
    <div id="main-menu">
    
<nav>
    <ul class="menu menu-main-menu">
        
        
<li class="dropdown first">

    <a href="http://particular.net/NServiceBus">Products</a> 
        <ul>
        
<li>

    <a href="http://particular.net/service-platform">The Service Platform</a> 
</li>
<li><span class="raw"><hr></span>
</li>
<li>

    <a href="http://particular.net/NServiceBus">NServiceBus</a> 
</li>
<li>

    <a href="http://particular.net/ServiceInsight-1">ServiceInsight</a> 
</li>
<li>

    <a href="http://particular.net/ServiceMatrix-1">ServiceMatrix</a> 
</li>
<li>

    <a href="http://particular.net/ServicePulse-1">ServicePulse</a> 
</li>
<li><span class="raw"><hr></span>
</li>
<li>

    <a href="http://particular.net/licensing">Licensing</a> 
</li>
<li>

    <a href="http://particular.net/downloads">Downloads</a> 
</li>
        </ul>
</li>
<li class="dropdown">

    <a href="http://particular.net/support">Services</a> 
        <ul>
        
<li>

    <a href="http://particular.net/support">Support</a> 
</li>
<li>

    <a href="http://particular.net/consulting">Consulting</a> 
</li>
<li>

    <a href="http://particular.net/onsite-training">On-site training</a> 
</li>
        </ul>
</li>
<li class="dropdown">

    <a href="http://particular.net/HandsOnLabs">Resources</a> 
        <ul>
        
<li>

    <a href="http://particular.net/documentation/nservicebus">Documentation</a> 
</li>
<li>

    <a href="http://particular.net/HandsOnLabs">Hands-on Labs</a> 
</li>
<li>

    <a href="http://particular.net/Videos-and-Presentations">Videos and Presentations</a> 
</li>
<li><span class="raw"><hr></span>
</li>
<li><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#ask-a-question">Ask a question</a>
</li>
<li>

    <a href="http://particular.net/SourceCode">Source code</a> 
</li>
        </ul>
</li>
<li class="dropdown">

    <a href="http://particular.net/champions">Community</a> 
        <ul>
        
<li><a href="http://particular.net/blog">Particular Blog</a>
</li>
<li>

    <a href="http://particular.net/DiscussionGroup">Discussion Group</a> 
</li>
<li>

    <a href="http://particular.net/champions">Community Champions</a> 
</li>
        </ul>
</li>
<li class="dropdown last">

    <a href="http://particular.net/about">Company</a> 
        <ul>
        
<li>

    <a href="http://particular.net/about">About Us</a> 
</li>
<li>

    <a href="http://particular.net/customers">Customers</a> 
</li>
<li>

    <a href="http://particular.net/CaseStudies">Case Studies</a> 
</li>
<li>

    <a href="http://particular.net/partners">Partners</a> 
</li>
<li>

    <a href="http://particular.net/Leadership">Leadership</a> 
</li>
<li>

    <a href="http://particular.net/contactus">Contact Us</a> 
</li>
        </ul>
</li>
    </ul>
</nav>
</div>
</article>
<article class="widget-search widget-navigation widget-search-form widget">
    



<form action="http://particular.net/Search" class="search-form" method="get">    <div>
        <input class="search" id="q" name="q" placeholder="Search" type="text" value="">
        <button name="button" title="Search" class="search-button" type="submit">
            <img src="./NServiceBus V4.0 release notes_files/search.png" class="search-icon">
        </button>
    </div>
</form>
</article></div>
        </div>

    <div id="layout-main" class="group">
        <div id="layout-content">
                            <div class="main-content">
                    <div class="zone zone-content">
<article class="content-item blog-post">
    <header>
        

<h1>NServiceBus V4.0 release notes</h1>
            <div class="metadata">
                <span class="data">Sep 04, 2013</span>
                

    <p class="tags">
        <span>Tags</span>
<a href="http://particular.net/Tags/NServiceBus">NServiceBus</a><a href="http://particular.net/Tags/v4.0">v4.0</a><a href="http://particular.net/Tags/Release%20Notes">Release Notes</a>    </p>


            </div>
    </header>
    


<h2>Contents</h2>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#compatibility">Compatibility and Upgrades</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#transports">New Transports Support and Configuration</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#configuration">Configuration Changes</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#powershell">PowerShell cmdlet&nbsp;Updates</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#endpoint-api">New Endpoint Configuration API</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#ravendb">Embedded RavenDB</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#unattended">Unattended Installation</a></p>

<p><a href="http://particular.net/blog/nservicebus-v4.0-release-notes#known-issues">Known Issues</a></p>

<h2><a id="compatibility" name="compatibility"></a>Compatibility and Upgrades</h2>

<div><b>Prerequisite: NServiceBus V4.0 requires RavenDB 2.0.0.2261 or later </b>

<div style="margin-left: 30px; margin-right: 30px;">NServiceBus V4.0 requires&nbsp;the latest RavenDB v2.x to be installed on the same machine.&nbsp;</div>

<ul>
	<li style="margin-left: 30px; margin-right: 30px;">You can manually validate the currently&nbsp;installed version of&nbsp;RavenDB &nbsp;by connecting to the RavenDB instance (http://localhost:8080) and examining the bottom status bar where the server and client build numbers are noted.&nbsp;Build numbers prior to 2000 indicate&nbsp;a RavenDB version&nbsp;earlier than&nbsp;2.x.</li>
	<li style="margin-left: 30px; margin-right: 30px;">If there is no existing and active installation of RavenDB v2.x on the machine, the NServiceBus installer&nbsp;automatically installs&nbsp;RavenDB v2.x.&nbsp;</li>
	<li style="margin-left: 30px; margin-right: 30px;">If the NServiceBus V4.0 installer finds a RavenDB version prior to 2.x on the target machine, it installs a new instance of RavenDB v2.x with no impact on the existing instance.</li>
</ul>
</div>

<div><b>NServiceBus V4.0 is not compatible with NServiceBus V2.6 (or earlier) </b>

<div style="margin-left: 30px; margin-right: 30px;">As you can see, a large number of features were added to NServiceBus. As a result, NServiceBus V4.0 is not compatible with NServiceBus V2.6. Furthermore, only messages marked as events (IEvent or DefiningEventsAs()) will be auto-subscribed.</div>
</div>

<div><b>PowerShell cmdlets - breaking changes</b>

<div style="margin-left: 30px; margin-right: 30px;">NServiceBus.Host no longer supports /installinfrastructure. Use PowerShell cmdlets instead.<br>
PowerShell cmdlets have been renamed so that they do not clash with any existing cmdlets. See details <a href="http://particular.net/blog/nservicebus-v4.0-release-notes#powershell">below</a>.</div>
</div>

<div><b>Autosubscriptions </b>

<div style="margin-left: 30px; margin-right: 30px;">Only messages marked as events (IEvent or DefiningEventsAs()) will be auto-subscribed.</div>
</div>

<div><b>Default transaction isolation level </b>

<div style="margin-left: 30px; margin-right: 30px;">The default transaction isolation level is now ReadCommitted. To revert to Serializable, use this code:</div>

<pre class="brush:csharp;" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;">Configure.Transactions.Advanced(settings =&gt; 
   settings.IsolationLevel(IsolationLevel.Serializable));
</pre>
</div>

<p><b>Working with Error and Audit queues</b></p>

<div style="margin-left: 30px; margin-right: 30px;">The Management Service (installed with NServiceBus V4.0) consumes the messages from the defined MSMQ Error and Audit queues. While the Management Service is running, you can&nbsp;view the the Error messages by viewing the Error.log queue, and auditing data can be viewed using <a href="http://particular.net/ServiceInsight" target="_blank">ServiceInsight</a>. You can manage the Management Service (named "Particular.Management") like any other Windows Service (see MSDN article on how to "<a href="http://technet.microsoft.com/en-us/library/cc736564(v=ws.10).aspx" target="_blank">Start, stop, pause, resume, or restart a service</a>").&nbsp;</div>

<p><strong>Callback behaviour when scaling out</strong></p>

<p style="margin-left: 40px;">When using a broker based transport&nbsp;endpoints will use a unique input per machine by default unless running the NServiceBus Host in As_aServer or As_aPublisher. This ensures callbacks work as expected when scaling out. If you are not using callbacks use&nbsp;Configure.ScaleOut(s=&gt;s.UseSingleBrokerQueue());&nbsp;to use the same central queue.</p>

<p><b>Namespace changes to Types and Interfaces</b></p>

<div style="margin-left: 40px;">
<div style="margin-left: 30px; margin-top: 20px;"><span style="font-weight: 600;">INeedInitialization:&nbsp;</span>Prior to NServicebus 4.0<span style="font-weight: 600;">,&nbsp;</span>The interface INeedInitialization was defined in NServiceBus.Config. In NServicebus 4.0, it is defined at the higher namespace level, i.e NServiceBus.&nbsp;If you receive the following compiler error, please remove the using reference to NServiceBus.Config and resolve using NServiceBus:&nbsp;error CS0104:</div>

<div style="margin-left: 30px; margin-top: 20px;">
<pre class="brush:csharp;" style="margin-left: 40px;">'INeedInitialization' is an ambiguous reference between 'NServiceBus.INeedInitialization' 
and 'NServiceBus.Config.INeedInitialization'</pre>

<p><span style="font-weight: 600;">NServiceBus.WebService:&nbsp;</span>Exposing an endpoint as a WebService using NServiceBus.Webservice&lt;YourMessage, YourEnum&gt; has been deprecated in 4.0. Use the WcfService option instead. For example:</p>

<pre class="brush:csharp;" style="margin-left: 40px;">YourWcfService : WcfService&lt;YourMessage, YourEnum&gt;</pre>

<p>&nbsp;</p>

<p><strong>SecondLevelRetries: </strong>The type SecondLevelRetries (used in the NServiceBus.Management.Retries namespace to configure the retry and the timeout policy) has been moved to the NServiceBus.Features namespace. While version 3.3.x had a separate policy for managing second level retries and timeouts, this has been merged into the new RetryPolicy in NServiceBus 4.0 and it is capable of achieving both functions.</p>

<p>&nbsp;</p>

<p><span style="font-weight: 600;">TransactionalTransport:&nbsp;</span>The type TransactionalTransport, which used to be defined in the namespace NServiceBus.Unicast.Transport.Transactional has been renamed to TransportReceiver and moved to the namespace NServiceBus.Unicast.Transport. If you receive the following compiler error, resolve using the new namespace specified above.</p>

<pre class="brush:csharp;" style="margin-left: 40px;">error CS0246: The type or namespace name 'TransactionalTransport' could not be found 
(are you missing a using directive or an assembly reference?)</pre>

<p>&nbsp;</p>
</div>
</div>

<div>
<h2><a id="transports" name="transports"></a> New Transports Support and Configuration</h2>

<div style="margin-left: 30px; margin-right: 30px;"><b>These new transport samples&nbsp;</b>were added to the NServiceBus samples, illustrating how to configure the new transports:

<ul>
	<li style="list-style-type: square;">Messaging.ActiveMQ</li>
	<li style="list-style-type: square;">Messaging.RabbitMQ</li>
	<li style="list-style-type: square;">Messaging.SqlServer</li>
	<li style="list-style-type: square;">Messaging.MSMQ</li>
</ul>
<a href="https://github.com/NServiceBus/NServiceBus/tree/develop/Samples">These samples are online</a>&nbsp;and included in the MSI installation samples sub-directory. More transports are on their way.</div>

<div style="margin-left: 30px; margin-top: 20px;"><b>New configuration APIs&nbsp;</b>simplify the transports configuration and make it consistent across all transports. In your config file, specify a connection string, like this:

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">connectionStrings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- MSMQ --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Transport" </span><span class="attr" style="color: rgb(255, 0, 0);">connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="deadLetter=true;
   journal=true;useTransactionalQueues=true;
   cacheSendConnection=true"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- ActiveMQ --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Transport" 
</span><span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="ServerUrl=activemq:tcp://localhost:61616"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;
</span><span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- RabbitMQ--&gt;
</span><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Transport" 
</span><span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="host=localhost"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- SqlServer --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Transport" 
   </span><span class="attr" style="color: rgb(255, 0, 0);">connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=nservicebus;
   Integrated Security=True"</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;/</span><span class="html" style="color: rgb(128, 0, 0);">connectionStrings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span>
</pre>
<br>
You then have two options to specify the transport:
<ul>
	<li>Specify it as part of the IConfigureThisEndpoint class declaration, e.g.:</li>
</ul>

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">public</span><span class="kwrd"> </span><span class="kwrd" style="color: rgb(0, 0, 255);">class  </span>EndpointConfig : IConfigureThisEndpoint, AsA_Server, 
       <span style="font-weight: 600;">UsingTransport&lt;RabbitMQ&gt;</span>
</pre>

<ul>
	<li>Or specify it in the IWantCustomInitialization Init method, e.g.:</li>
</ul>

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">public</span><span class="kwrd"> </span><span class="kwrd" style="color: rgb(0, 0, 255);">class </span>EndpointConfig : IConfigureThisEndpoint, AsA_Server, 
IWantCustomInitialization
{
<span class="kwrd" style="color: rgb(0, 0, 255);">   public</span><span class="kwrd" style="color: rgb(0, 0, 255);"> void </span>Init(){
      Configure.With().DefaultBuilder()
<span style="font-weight: 600;">         .UseTransport&lt;RabbitMQ&gt;()
   </span>}
}
</pre>
</div>

<div style="margin-left: 30px; margin-top: 20px;">
<h3><b>New NuGet packages for the new transports&nbsp;</b></h3>

<p>These NuGet packages&nbsp;are also available:</p>

<ul>
	<li style="list-style-type: square;"><a href="https://nuget.org/packages/NServiceBus.SqlServer/" target="_blank">NServiceBus.SqlServer</a></li>
	<li style="list-style-type: square;"><a href="https://nuget.org/packages/NServiceBus.ActiveMQ/" target="_blank">NServiceBus.ActiveMQ</a></li>
	<li style="list-style-type: square;"><a href="https://nuget.org/packages/NServiceBus.RabbitMQ/" target="_blank">NServiceBus.RabbitMQ</a></li>
</ul>

<div style="margin-left: 30px;"><b>Example of how to install the NServiceBus.ActiveMQ package</b>

<div class="nuget-badge">
<p><code style="background-color: rgb(32, 32, 32); border: 4px solid rgb(192, 192, 192); border-top-left-radius: 5px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; box-shadow: rgb(110, 110, 110) 2px 2px 3px; color: rgb(226, 226, 226); display: block; font-size: 1.2em; font-family: &#39;andale mono&#39;, &#39;lucida console&#39;, monospace; line-height: 1.2em; overflow: auto; padding: 1px;">PM&gt; Install-Package NServiceBus.ActiveMQ</code></p>
</div>
</div>
</div>

<div style="margin-left: 30px; margin-top: 20px;">
<h3><b>New Transport DLLs&nbsp; </b></h3>

<p>Add a reference to the new transport DLLs (in the Binaries directory):</p>

<ul>
	<li style="list-style-type: square;">NServiceBus.Transports.RabbitMQ.dll</li>
	<li style="list-style-type: square;">NServiceBus.Transports.SQlServer.dll</li>
	<li style="list-style-type: square;">NServiceBus.Transports.ActiveMQ.dll</li>
</ul>
MSMQ is currently in NServiceBus.Core.dll and does not require any additional reference. NuGet adds the reference automatically.</div>
</div>

<div>
<h2><a id="configuration" name="configuration"></a> Configuration Changes</h2>

<div style="margin-left: 30px;"><b>XmlMessageSerializer&nbsp;</b>now supports not wrapping messages in a &lt;messages&gt; element for single messages. This makes interoperability with other systems easier.<br>
To turn on this feature:
<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;">.XmlSerializer( dontWrapSingleMessages: <span class="kwrd" style="color: rgb(0, 0, 255);">true </span>)
</pre>
</div>

<div style="margin-left: 30px; margin-top: 20px;">
<p>&nbsp;</p>

<p>The <b>MsmqTransportConfig</b>&nbsp;section has been deprecated in favour of TransportConfig section, like this:</p>

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">section</span><span class="html"> </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="TransportConfig"</span><span class="kwrd"> 
   </span><span class="attr" style="color: rgb(255, 0, 0);">type</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus.Config.TransportConfig, NServiceBus.Core"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">TransportConfig</span><span class="html"> </span><span class="attr" style="color: rgb(255, 0, 0);">MaximumConcurrencyLevel</span><span class="kwrd" style="color: rgb(0, 0, 255);">="10"</span><span class="kwrd"> </span><span class="attr" style="color: rgb(255, 0, 0);">MaxRetries</span><span class="kwrd" style="color: rgb(0, 0, 255);">="3"</span><span class="kwrd"> 
   </span><span class="attr" style="color: rgb(255, 0, 0);">MaximumMessageThroughputPerSecond</span><span class="kwrd" style="color: rgb(0, 0, 255);">="10"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
</pre>
</div>

<div style="margin-left: 30px; margin-top: 20px;">&nbsp;</div>

<div style="margin-left: 30px; margin-top: 20px;"><b>INeedToInstallSomething: </b>The&nbsp;INeedToInstallSomething interface<b>&nbsp;</b>is now resolved via the container.</div>

<div style="margin-left: 30px; margin-top: 20px;">&nbsp;</div>

<div style="margin-left: 30px; margin-top: 20px;">
<h3><b>NHibernate Configuration&nbsp; </b></h3>

<p>NHibernate settings have been simplified, as follows:</p>

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">appSettings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span><span class="rem" style="color: rgb(0, 128, 0);">&lt;
!-- dialect is the only required NHibernate property --&gt;
</span><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add</span><span class="html"> </span><span class="attr" style="color: rgb(255, 0, 0);">key</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/dialect"
   </span><span class="attr" style="color: rgb(255, 0, 0);">value</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NHibernate.Dialect.MsSql2008Dialect"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- other optional settings examples --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">key</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/connection.provider" 
   </span><span class="attr" style="color: rgb(255, 0, 0);">value</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NHibernate.Connection.DriverConnectionProvider"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">key</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/connection.driver_class"
   </span><span class="attr" style="color: rgb(255, 0, 0);">value</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NHibernate.Driver.Sql2008ClientDriver"</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- For more settings: 
see http://www.nhforge.org/doc/nh/en/#configuration-hibernatejdbc 
and</span><span class="rem"> </span><span class="rem" style="color: rgb(0, 128, 0);">http://www.nhforge.org/doc/nh/en/#configuration-optional 
--&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;/</span><span class="html" style="color: rgb(128, 0, 0);">appSettings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;
</span><span class="html" style="color: rgb(128, 0, 0);">connectionStrings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;
</span><span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- Default connection string for all Nhibernate/Sql persisters --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence" 
   </span><span class="attr" style="color: rgb(255, 0, 0);">connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=nservicebus;
   Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="rem" style="color: rgb(0, 128, 0);">&lt;!-- Optional overrides per persister --&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/Timeout" </span>
<span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=timeout;
   Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/Saga" 
</span><span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=sagas;
   Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;a</span><span class="html" style="color: rgb(128, 0, 0);">dd</span><span class="html"> </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/Subscription"
</span><span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=subscription;
   Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/Gateway" </span>
<span class="attr" style="color: rgb(255, 0, 0);">   connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=gateway;
Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">add </span><span class="attr" style="color: rgb(255, 0, 0);">name</span><span class="kwrd" style="color: rgb(0, 0, 255);">="NServiceBus/Persistence/NHibernate/Distributor"</span>
<span class="attr" style="color: rgb(255, 0, 0);">connectionString</span><span class="kwrd" style="color: rgb(0, 0, 255);">="Data Source=.\SQLEXPRESS;Initial Catalog=distributor;
Integrated Security=True"</span><span class="kwrd" style="color: rgb(0, 0, 255);">/&gt;</span>
<span class="kwrd" style="color: rgb(0, 0, 255);">&lt;/</span><span class="html" style="color: rgb(128, 0, 0);">connectionStrings</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span>
</pre>
</div>

<h3 style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><b>Performance Counters&nbsp; </b></h3>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;">New throughput performance counters and updated performance counters are available:<br>
<br>
<img alt="" src="./NServiceBus V4.0 release notes_files/nsb40perfcounter.png"></div>

<h3 style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><b>NServiceBus license installed per machine&nbsp; </b></h3>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;">Licenses can now be installed in HKLM, allowing you to install one license per server instead of installing a license per endpoint or per Windows account.<br>
Sample usage:</div>

<div style="margin-left: 30px; padding: 10px; margin-top: 5px; border: 1px solid black;">LicenseInstaller.exe C:\License.xml</div>

<div style="margin-left: 30px; margin-top: 20px;">
<h2><b><a id="powershell" name="powershell"></a> Powershell cmdlet&nbsp;Updates&nbsp; </b></h2>

<p>NServiceBus PowerShell cmdlets have moved to NServiceBus.PowerShell.dll.&nbsp;To import it, run this:</p>

<div class="nuget-badge">
<p><code style="background-color: rgb(32, 32, 32); border: 4px solid rgb(192, 192, 192); border-top-left-radius: 5px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; box-shadow: rgb(110, 110, 110) 2px 2px 3px; color: rgb(226, 226, 226); display: block; font-size: 1.2em; font-family: &#39;andale mono&#39;, &#39;lucida console&#39;, monospace; line-height: 1.2em; overflow: auto; padding: 1px;">PM&gt; Import-Module .\NServiceBus.PowerShell.dll</code></p>
</div>
NServiceBus Powershell cmdlets have been renamed so they do not clash with any existing cmdlets:

<ul>
	<li style="list-style-type: square;">Installs a NServiceBus license file.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Install-NServiceBusLicense</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Displays all messages in a queue.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Get-NServiceBusMSMQMessage</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Displays the NServiceBus installed version.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Get-NServiceBusVersion</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Installs DTC on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Install-NServiceBusDTC</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Installs RavenDB on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Install-NServiceBusRavenDB</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Installs NServiceBus performance counters on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Install-NServiceBusPerformanceCounters</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Installs MSMQ on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Install-NServiceBusMSMQ</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Validates if DTC is installed and running on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Test-NServiceBusDTCInstallation</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Ensures RavenDB is on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Test-NServiceBusRavenDBInstallation</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Validates that NServiceBus performance counters are correctly installed on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Test-NServiceBusPerformanceCountersInstallation</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Validates MSMQ is correctly installed on the machine.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Test-NServiceBusMSMQInstallation</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Adds the required configuration section to the config file.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Add-NServiceBusMessageForwardingInCaseOfFaultConfig</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Shows the default error and audit queues.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Get-NServiceBusLocalMachineSettings</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;">Allows specifying the default error and audit queues.
	<div style="padding: 10px; margin-top: 5px; border: 1px solid black;">Set-NServiceBusLocalMachineSettings</div>
	</li>
	<li style="list-style-type: square; margin-top: 10px;"><b>NServiceBus.Host no longer supports /installinfrastructure.&nbsp;Use PowerShell cmdlets instead.</b></li>
</ul>
</div>

<div style="margin-left: 30px; margin-top: 20px;">
<h2><b><a id="endpoint-api" name="endpoint-api"></a> New Endpoint Configuration API</b></h2>

<p>Sample usage:</p>

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;">Configure.Endpoint.AsSendOnly()
&nbsp;&nbsp; .Advanced(settings =&gt; settings.DisableDurableMessages());
Configure.Transactions.Enable() 
&nbsp;&nbsp; .Advanced(settings =&gt; settings.IsolationLevel(IsolationLevel.Serializable)
&nbsp;&nbsp; .DefaultTimeout(TimeSpan.FromSeconds(40)) 
&nbsp;&nbsp; .DisableDistributedTransactions()); 
</pre>
</div>

<h2 style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><b><a id="ravendb" name="ravendb"></a> Embedded RavenDB&nbsp; </b></h2>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;">RavenDB is not ilmerged anymore. It is embedded instead, using&nbsp; <a href="https://github.com/Fody/Costura#readme" target="_blank">https://github.com/Fody/Costura#readme</a>.<br>
The embedding enables client updates (but may require binding redirects). It also allows passing your own DocumentStore, thereby providing full configuration flexibility.&nbsp;</div>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><b>Audit and Error Queue Defaults&nbsp; </b><br>
Server defaults for audit and error queues can now be specified in the registry (see new PowerShell cmdlet Get/Set-NServiceBusLocalMachineSettings, above).</div>
</div>

<div>
<h2><a id="unattended" name="unattended"></a>Unattended Installation</h2>

<div>
<div style="margin-left: 40px; margin-right: 30px; margin-top: 20px;"><span style="font-size: 14px; line-height: 24px;">The NServiceBus installer can be executed&nbsp;in quiet, unattended mode by running the following command:</span></div>

<div style="margin-left: 80px; margin-right: 30px; margin-top: 20px;"><span style="font-family:courier new,courier,monospace;"><span style="font-size: 14px; line-height: 24px;">Particular.NServiceBus-4.0.x.exe /q /l install.log</span></span></div>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><span style="font-size: 14px; line-height: 24px;">This will run the installer in quiet mode and create a log file called install.log.&nbsp;</span></div>

<div style="margin-left: 30px; margin-right: 30px; margin-top: 20px;"><span style="font-size: 14px; line-height: 24px;">Note that the name of the installer file may differ from the above example, and that&nbsp;</span><span style="font-size: 14px; line-height: 24px;">running the installer in quiet mode still opens a browser window&nbsp;to the&nbsp;<a href="http://particular.net/">Partic</a></span><span style="font-size: 14px; line-height: 24px;"><a href="http://particular.net/">ular Software</a>&nbsp;website&nbsp;when the installation is completed.</span></div>
</div>

<div>
<h2><a id="known-issues" name="known-issues"></a>Known Issues</h2>
<b>ActiveMQ requires enabling the Scheduler.&nbsp; </b><br>
&nbsp;&nbsp;&nbsp; You can do this by setting the&nbsp;<b>schedulerSupport="true"&nbsp;</b>attribute to the configuration in activemq.xml:

<pre class="csharpcode" style="font-size: small; font-family: Consolas, &#39;Courier New&#39;, Courier, monospace; border: 1px solid black;"><span class="kwrd" style="color: rgb(0, 0, 255);">&lt;</span><span class="html" style="color: rgb(128, 0, 0);">broker</span><span class="html"> ​</span><span class="attr" style="color: rgb(255, 0, 0);">xmlns</span><span class="kwrd" style="color: rgb(0, 0, 255);">="http://activemq.apache.org/schema/core"</span><span class="kwrd"> </span><span class="attr" style="color: rgb(255, 0, 0);">brokerName</span><span class="kwrd" style="color: rgb(0, 0, 255);">="localhost"</span><span class="kwrd"> 
</span><span class="attr" style="color: rgb(255, 0, 0);">dataDirectory</span><span class="kwrd" style="color: rgb(0, 0, 255);">="${activemq.data}"</span><span class="kwrd"> </span><span class="attr" style="color: rgb(255, 0, 0);">schedulerSupport</span><span class="kwrd" style="color: rgb(0, 0, 255);">="true"</span><span class="kwrd" style="color: rgb(0, 0, 255);">&gt;</span>
</pre>
<b> ActiveMQ Client connection fails when hostname includes a hyphen&nbsp; </b> &nbsp;<br>
&nbsp; &nbsp; See&nbsp;<a href="https://issues.apache.org/jira/browse/AMQNET-399" target="_blank">https://issues.apache.org/jira/browse/AMQNET-399</a>.&nbsp;<br>
<br>
<b>NMS Client for ActiveMQ&nbsp; </b><br>
The release contains a custom build of Apache.NMS.ActiveMQ.1.5.6 client.&nbsp;This custom build fixes the following issues:
<ul>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-412" target="_blank"><b>AMQNET-412&nbsp; </b>: Messages are enlisted to the wrong transaction</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-413" target="_blank"><b>AMQNET-413&nbsp; </b>: Message producers do not respect DTC Transactions correctly</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-414" target="_blank"><b>AMQNET-414&nbsp; </b>: Exception thrown when using DTC in multiple processes connected to the same broker</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-416" target="_blank"><b>AMQNET-416&nbsp; </b>: DTC Ressource ManagerID must be configurable</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-417" target="_blank"><b>AMQNET-417&nbsp; </b>: DTC Recovery should be done once for each application start</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-418" target="_blank"><b>AMQNET-418&nbsp; </b>: Recovery File Logger does not support multiple concurrent transactions</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-419" target="_blank"><b>AMQNET-419&nbsp; </b>: The MessageConsumer sometimes does not send a RemoveInfo when closed</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-420" target="_blank"><b>AMQNET-420&nbsp; </b>: Session does not pass correct last delivered message in the Remove Info</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-421" target="_blank"><b>AMQNET-421&nbsp; </b>: Replace Mutex by lock</a></li>
	<li><a href="https://issues.apache.org/jira/browse/AMQNET-422" target="_blank"><b>AMQNET-422&nbsp; </b>: Added support for transactions for Asyncronous Listeners</a></li>
</ul>
<b> The custom build will be removed as soon as the official NMS client is updated with the above fixes.&nbsp; </b> &nbsp;<br>
<br>
<b>Installing RavenDB v2.x on a machine that already has RavenDB v1.x&nbsp; </b><br>
When installing NServiceBus V4.x on a machine where an instance of RavenDB v1.x exists (default listening on port 8080), the installer will identify the existing RavenDB instance and try to capture the next available port (8081, 8082, etc.) instead of the default 8080 port. Once an available port is found, the installer installs RavenDB v2.x instance as a new Windows service, side-by-side with the existing RavenDB v1.x installation.&nbsp;<br>
By the end of the installation there will be two RavenDB services running side by side on the machine:
<ul>
	<li>RavenDB</li>
	<li>RavenDB v2</li>
</ul>
To uninstall RavenDB v2, follow these steps:

<ol>
	<li>Open a command line and navigate to this&nbsp;directory:&nbsp;<br>
	<b>%Program Files%\NServiceBus.Persistence.V4 </b></li>
	<li>Execute this&nbsp;command:<br>
	<b>Raven.Server.exe –uninstall –service-name=RavenDB-v2 </b></li>
</ol>

<p>Note that uninstalling NServiceBus (via the installer or through Control Panel &gt; Programs)&nbsp;does not uninstall any&nbsp;RavenDB installations. &nbsp;<b>​</b></p>
<b>Transport samples do not work with Visual Studio 2010&nbsp; </b><br>
All the new transports introduced with NServiceBus 4.0&nbsp;<u><span style="font-weight: 600;">do not</span></u>&nbsp;work with Visual Studio 2010. The supplied samples currently work only with Visual Studio 2012.&nbsp;<br>
&nbsp;
<div style="margin-left: 20px;"><b>Windows Azure </b>

<ul>
	<li>Updated to the version 2.0&nbsp;of the storage client.</li>
	<li>NHibernate is no longer needed when using NServiceBus on Windows Azure (<a href="https://github.com/NServiceBus/NServiceBus/commit/3622ec6208f7c4c057fc3c3738e1e9b72e38d4fb">details</a>).</li>
</ul>
<b> RabbitMQ </b>

<ul>
	<li>Has improved support for high performance polymorphic pub/sub (<a href="https://github.com/NServiceBus/NServiceBus/commit/e9a9331cc73f2893f73e2c1b14bc08ef6775ad5f">details</a>).</li>
	<li>Thanks to<b>&nbsp;Fawad Halim&nbsp;</b>and&nbsp;<b>Jeff Sogolov&nbsp;</b>from ADP!</li>
</ul>
<b> NHibernate </b>

<ul>
	<li>Sagas are now mapped using the table per concrete class strategy to avoid join tables when using base classes for sagas. This improves performance when reading/writing sagas to the database (<a href="http://ayende.com/blog/3941/nhibernate-mapping-inheritance" target="_blank">details</a>).</li>
</ul>
<b> SQL Server Transport </b>

<p><b>NOTE:&nbsp;</b>Due to schema changes from NServiceBus V4.0 Beta, to use SQL Server Transport with NServiceBus V4.0, delete any tables created with NServiceBus V4.0 Beta.&nbsp;</p>

<ul>
	<li>No longer using the deprecated timestamp column type (<a href="https://github.com/NServiceBus/NServiceBus/issues/1117">details</a>).</li>
	<li>Machine name is no longer used in the address for broker based transports. This fixes and issue when scaled out subscribers would receive duplicate messages (<a href="https://github.com/NServiceBus/NServiceBus/commit/2e8b481396a1bd26b48a88d23262d8abc8d63b09">details</a>).</li>
	<li>Uses&nbsp;the ROWLOCK hint to make sure that no table locks are used (<a href="https://github.com/NServiceBus/NServiceBus/issues/1093">details</a>).</li>
	<li>Fixed a critical bug in the sql transport where a exception from a message handler would cause the message to be retried indefinitely (<a href="https://github.com/NServiceBus/NServiceBus/issues/1091">details</a>).</li>
	<li>The video store sample has been improved with better naming and also displays how to use our InMemory support for domain events (<a href="https://github.com/NServiceBus/NServiceBus/commit/74ee05eb6dd98fd956f0cbd7c37e626d018a7b9c">details</a>).</li>
	<li>Profiles are now working correctly when endpoints are installed as windows services (<a href="https://github.com/NServiceBus/NServiceBus/issues/1112">details</a>).</li>
	<li>Impersonation support renamed to better reflect the actual use case for it (<a href="https://github.com/NServiceBus/NServiceBus/issues/1104">details</a>).</li>
	<li>Improved the API&nbsp;for reacting to profiles being enabled (<a href="https://github.com/NServiceBus/NServiceBus/pull/1105">details</a>).</li>
	<li>Switching between persistence technologies is now easier (<a href="https://github.com/NServiceBus/NServiceBus/commit/6b9d1cb880eaa163b1fc1fa52bcff4253bf0ac3f">details</a>).</li>
	<li>ISagaStartedBy is now obsolete.&nbsp;To start sagas, use IAmStartedByMessages instead&nbsp;(<a href="https://github.com/NServiceBus/NServiceBus/commit/8e23d3af3a57082398aeaeb58cb8900a23b4c079">details</a>).</li>
</ul>

<p><strong>Installing NServiceBus on Windows Server 2012</strong></p>

<ul>
	<li>When installing NServiceBus v4 on Windows Server 2012, MSMQ must be installed manullay prior to NServiceBus installation. See MSDN article "<a href="http://technet.microsoft.com/en-us/library/cc771474.aspx" target="_blank">Installing and Managing Message Queuing</a>" for more details.</li>
</ul>
</div>
</div>
</div>




    <a class="addComments" href="http://particular.net/blog/nservicebus-v4.0-release-notes#comments-block">Leave a Comment</a>    
    <div id="comments-message"></div>
    <div id="comments-block" style="display: none;">
            <div id="leave-comment-block" style="">
                <img alt="logo" src="./NServiceBus V4.0 release notes_files/logo.png">
                <div class="header text-dosis-28"><strong>Leave comment on this blog post</strong></div>
                <div class="text-lato-16">
                    <p class="required text-lato-12">fields marked with <span class="data-emphasize"><strong>*</strong></span> are required</p>

<form action="http://particular.net/Blog/Comment/Create" class="comment-form form-horizontal " method="post"><input id="Name" name="Name" type="hidden" value="sean.farmar"><input id="Email" name="Email" type="hidden" value="s.farmar@gmail.com">                        <h2 id="commenter">Hi, sean.farmar!</h2>
                        <div class="control-group">
                            <label class="control-label" for="comment-text">Comment<span class="data-emphasize"><strong>*</strong></span></label>
                            <div class="controls">
                                <textarea id="comment-text" rows="10" cols="70" name="CommentText"></textarea>
                                
                            </div>
                        </div>        
                        <div class="control-group">
                            <div class="controls">
                                <button class="primaryAction send-comment" type="button">Post Comment</button>
                                <span class="note-data">Note: Comments need to be approved before displaying</span>
                            </div>
                        </div>
<input id="CommentedOn" name="CommentedOn" type="hidden" value="366"><input id="ReturnUrl" name="ReturnUrl" type="hidden" value="http://particular.cloudapp.net/blog/nservicebus-v4.0-release-notes"><input name="__RequestVerificationToken" type="hidden" value="fT9b38hAePNLEbco6REdrDEylB9kYJpiM1FlohNfUQ5eIB_CMcVcSiJF_O4tWl1qPbCXVTY5H9o7km_soyvbNlyE1zLegEBha62NIIwN9uALyqg2zkYOnGxcfMK2HEcqb-ErPerMGxF_LBNA_TjAGL_TtTQ1"></form>                </div>
            </div>
    </div>





</article></div>
                </div>
                    </div>
            <aside id="aside-second" class="aside-second">
                <div class="zone zone-aside-second">
<article class="widget-aside-second widget-html-widget widget">
    <header>
        <h1>Community</h1>
        
    </header>
    
<div class="side-list">
  <!--
<ul>
<li>
<a href="/community-champions">Community champions</a>
</li>
<li>
<a href="/contribute">Contribute</a>
</li>
<li class="active">
<a href="/blog">Blog</a>
</li>
</ul>
-->
  <ul>
    <li class="active">
      <a href="http://particular.net/blog">Particular Blog</a>
    </li>
    <li>
      <a href="http://particular.net/DiscussionGroup">Discussion group</a>
    </li>
    <li>
      <a href="http://particular.net/champions">Community champions</a>
    </li>
  </ul>
</div>

</article>
<article class="widget-tagcloud widget-aside-second widget-tag-cloud widget">
    <header>
        <h1>Blog Tags</h1>
        
    </header>
    
<ul class="tagcloud">
    <li class="tagCloud-tag tagCloud-8">
        <a href="http://particular.net/Tags/NServiceBus">NServiceBus</a>
    </li>
    <li class="tagCloud-tag tagCloud-1">
        <a href="http://particular.net/Tags/Patch">Patch</a>
    </li>
    <li class="tagCloud-tag tagCloud-8">
        <a href="http://particular.net/Tags/Release%20Notes">Release Notes</a>
    </li>
    <li class="tagCloud-tag tagCloud-8">
        <a href="http://particular.net/Tags/v4.0">v4.0</a>
    </li>
</ul>
</article>
<article class="widget-aside-second widget-blog-archives widget">
    <header>
        <h1>Archives</h1>
        
    </header>
    

<ul class="archiveMonthList"><li class="first"><a href="http://particular.net/blog/archive/2013/7">July 2013 (5)</a></li><li class=""><a href="http://particular.net/blog/archive/2013/6">June 2013 (3)</a></li><li class="last"><a href="http://particular.net/blog/archive/2013/5">May 2013 (19)</a></li></ul>
</article></div>
            </aside>
    </div>

        <div class="footer">
            <div class="zone zone-footer">
<article class="widget-footer widget-html-widget widget">
    
<style type="text/css">
  .validateerror {
    border-color: #f32938!important;
    border-width: 1px!important;
    border-style: solid!important;
  }
  .validateerrortext{
    color: #f32938!important;
  }
  .validateerrortext .data-emphasize{
    color: #f32938!important;
  }
</style>
<style type="text/css">
  .gist-meta {
    display: none;
  }
</style>
<script type="text/javascript">
		$(document).ready(function(){
        	$('#ContactUsFooter').click(function()						{ _gaq.push(['_trackEvent', 'Action Performed', 'Contact Us Menu - Footer']); });
			$('#contact-us-button').click(function()					{ _gaq.push(['_trackEvent', 'Action Performed', 'Write To Us - Footer']); });
		});
</script>
<div class="aboutus-footer">
  <div class="logo">
    <div class="contactus-menu">
      <img alt="phone" src="./NServiceBus V4.0 release notes_files/phone-contactus.png">
      <div>
        <p>
          <span class="data"><strong>US toll free</strong></span>
          (888) 495-6156
        </p>
        <p>
          <span class="data"><strong>New York</strong></span>
          (646) 688-5075
        </p>
        <p>
          <span class="data"><strong>London</strong></span>
          02033 717392
        </p>
        <p>
          <span class="data"><strong>Sydney</strong></span>
          (02) 8310-4202
        </p>
        <p>
          <span class="data"><strong>Tel Aviv</strong></span>
          (03) 721-9577
        </p>
      </div>
      <img alt="email" src="./NServiceBus V4.0 release notes_files/email-contactus.png">
      <div class="button small">
        <a class="blue fancybox" href="http://particular.net/blog/nservicebus-v4.0-release-notes#contact-us-block" id="contact-us-button">Write to Us</a>
      </div>
    </div>
    <div class="contactus-button">
      <a class="inactive" href="javascript:void(0)" id="ContactUsFooter">Contact Us &nbsp;&nbsp; <img alt="triangle-up" src="./NServiceBus V4.0 release notes_files/triangle-up.png"> </a>
      <a class="active" href="javascript:void(0)" style="display: none;">Contact Us &nbsp;&nbsp; <img alt="triangle-down" src="./NServiceBus V4.0 release notes_files/triangle-down.png"> </a>
    </div>
  </div>
  <div class="footer-menu">
    <ul>
      <li>
        <a class="first" href="http://particular.net/nservicebus">Products</a>
      </li>
      <li>
        <a href="http://particular.net/service-platform">The Service Platform</a>
      </li>
      <li>
        <a href="http://particular.net/nservicebus">NServiceBus</a>
      </li>
      <li>
        <a href="http://particular.net/ServiceMatrix">ServiceMatrix</a>
      </li>
      <li>
        <a href="http://particular.net/ServiceInsight">ServiceInsight</a>
      </li>
      <li>
        <a href="http://particular.net/licensing">Licensing</a>
      </li>
      <li>
        <a href="http://particular.net/downloads">Downloads</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="first" href="http://particular.net/support">Solutions</a>
      </li>
      <li>
        <a href="http://particular.net/support">Support</a>
      </li>
      <li>
        <a href="http://particular.net/consulting">Consulting</a>
      </li>
      <li>
        <a href="http://particular.net/onsite-training" target="_blank">On-site training</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="first" href="http://particular.net/documentation/nservicebus">Resources</a>
      </li>
      <li>
        <a href="http://particular.net/documentation/nservicebus">Documentation</a>
      </li>
      <li>
        <a href="http://particular.net/HandsOnLabs">Hands-on labs</a>
      </li>
      <li>
        <a href="http://particular.net/Videos-and-Presentations">Videos and Presentations</a>
      </li>
      <li>
        <a href="http://particular.net/contactus#ask-a-question">Ask a question</a>
      </li>
      <li>
        <a href="http://particular.net/sourcecode">Source code</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="first" href="http://particular.net/blog">Community</a>
      </li>
      <li>
        <a href="http://particular.net/blog">Particular blog</a>
      </li>
      <li>
        <a href="http://particular.net/DiscussionGroup">Discussion group</a>
      </li>
      <li>
        <a href="http://particular.net/champions" target="_blank">Community Champions</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="first" href="http://particular.net/about">Company</a>
      </li>
      <li>
        <a href="http://particular.net/about">About</a>
      </li>
      <li>
        <a href="http://particular.net/customers">Customers</a>
      </li>
      <li>
        <a href="http://particular.net/casestudies">Case Studies</a>
      </li>
      <li>
        <a href="http://particular.net/partners">Partners</a>
      </li>
      <li>
        <a href="http://particular.net/Leadership">Leadership</a>
      </li>
      <li>
        <a href="http://particular.net/ContactUs">Contact Us</a>
      </li>
    </ul>
  </div>
  <div class="copyright" style="padding-top: 0px; margin-left:30px;">
    Copyright © 2013 Particular Software Limited. All rights reserved | 
    <a href="http://particular.net/Privacy" style="color: rgb(145, 158, 158);">Privacy Policy</a>
  </div>
  <div id="contact-us-block" style="display: none;">
    <img alt="logo" src="./NServiceBus V4.0 release notes_files/logo.png">
    <div class="header text-dosis-28">
      <strong>Write to us</strong>
    </div>
    <div class="text-lato-16">
      <p class="required text-lato-12">
        fields marked with 
        <span class="data-emphasize"><strong>*</strong></span>
        are required
      </p>
      <form class="form-horizontal">
        <input class="title" name="title" type="hidden" value="Write to Us">
        <input class="data" name="data" type="hidden" value="Fri Oct 11 2013 17:00:39 GMT+0100 (GMT Daylight Time)">
        <input class="url" name="url" type="hidden" value="http://particular.net/blog/nservicebus-v4.0-release-notes">
        <div class="control-group1">
          <div class="control-group2">
            <label class="control-label" for="name">First name<span class="data-emphasize"><strong>*</strong></span></label>
            <div class="controls2">
              <input class="firstname" name="firstname" type="text">
            </div>
          </div>
          <div class="control-group2">
            <label class="control-label" for="name">Last name<span class="data-emphasize"><strong>*</strong></span></label>
            <div class="controls2">
              <input class="lastname" name="lastname" type="text">
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="company">Company</label>
          <div class="controls">
            <input class="company" name="company" type="text">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="email">Email<span class="data-emphasize"><strong>*</strong></span></label>
          <div class="controls">
            <input class="email" name="email" type="text">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="phone">Phone number</label>
          <div class="controls">
            <input class="phone" name="phone" type="text">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="message">Message<span class="data-emphasize"><strong>*</strong></span></label>
          <div class="controls">
            <textarea cols="70" name="message" rows="9"></textarea>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button class="btn text-lato-16" onclick="return false;" style="float:left" type="submit">Send Message</button>
            <div class="messageboxerror" style="display:none; float:left;color:#f32938;padding-left:30px;padding-top:10px">
              <b>
                Please fill in all required information! 
              </b>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div id="ask-a-question" style="display: none;">
    <img alt="logo" src="./NServiceBus V4.0 release notes_files/logo.png">
    <div class="header text-dosis-28">
      <strong>Ask a question</strong>
    </div>
    <div class="text-lato-16">
      <p class="required text-lato-12">
        fields marked with 
        <span class="data-emphasize"><strong>*</strong></span>
        are required
      </p>
      <form class="form-horizontal">
        <input class="title" name="title" type="hidden" value="Ask a question">
        <input class="data" name="data" type="hidden" value="Fri Oct 11 2013 17:00:39 GMT+0100 (GMT Daylight Time)">
        <input class="url" name="url" type="hidden" value="http://particular.net/blog/nservicebus-v4.0-release-notes">
        <div class="control-group1">
          <div class="control-group2">
            <label class="control-label" for="name">First name<span class="data-emphasize"><strong>*</strong></span></label>
            <div class="controls2">
              <input class="firstname" name="firstname" type="text">
            </div>
          </div>
          <div class="control-group2">
            <label class="control-label" for="name">Last name<span class="data-emphasize"><strong>*</strong></span></label>
            <div class="controls2">
              <input class="lastname" name="lastname" type="text">
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="company">Company</label>
          <div class="controls">
            <input class="company" name="company" type="text">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="email">Email<span class="data-emphasize"><strong>*</strong></span></label>
          <div class="controls">
            <input class="email" name="email" type="text">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="message">Message<span class="data-emphasize"><strong>*</strong></span></label>
          <div class="controls">
            <textarea cols="70" name="message" rows="9"></textarea>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button class="btn text-lato-16" onclick="return false;" type="submit">Send Message</button>
            <div class="messageboxerror" style="display:none; float:left;color:#f32938;padding-left:30px;padding-top:10px">
              <b>
                Please fill in all required information! 
              </b>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

</article></div>
        </div>
</div>
<div class="footer-mirror"></div>


<script src="./NServiceBus V4.0 release notes_files/base.js" type="text/javascript"></script>
<script src="./NServiceBus V4.0 release notes_files/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="./NServiceBus V4.0 release notes_files/jquery.fancybox-media.js" type="text/javascript"></script>
<script src="./NServiceBus V4.0 release notes_files/jquery.carouFredSel-6.2.0.js" type="text/javascript"></script>
<script src="./NServiceBus V4.0 release notes_files/orchard-blogs-archives.js" type="text/javascript"></script>
    <script type="text/javascript">
        //<![CDATA[  
        $('.addComments').fancybox();
        //]]>
        $(".send-comment").click(function () {
            $.ajax({
                url: 'Comment/Create',
                data: {
                    Name: $("#Name").val(),
                    Email: $("#Email").val(),
                    CommentText: $("#comment-text").val(),
                    recaptcha_response_field: $("#recaptcha_response_field").val(),
                    recaptcha_challenge_field: $("#recaptcha_challenge_field").val(),
                    CommentedOn: $("#CommentedOn").val(),
                    ReturnUrl: $("#ReturnUrl").val(),
                    __RequestVerificationToken: $("input[name=__RequestVerificationToken]").val()
                },
                success: function (data) {
                    if (!data.Name) {
                        $("#Name").val("");
                        $("#Name").attr("placeholder", "Name is mandatory and must have less than 255 chars");
                    }
                    if (!data.Email) {
                        $("#Email").val("");
                        $("#Email").attr("placeholder", "Email is invalid or is longer than 255 chars");
                    }
                    if (!data.CommentText) {   
                        $("#comment-text").val("");
                        $("#comment-text").attr("placeholder", "Comment is mandatory");
                    }
                    if (!data.Recaptcha) {
                        $("#RechptchaMessage").empty();
                        $("#RechptchaMessage").text("Please enter correct Values exactly as you can see in the Picture!");
                    }
                    if (data.CommentCreated) {
                        $.fancybox.close();  
                        $("#comments-message").text("Comment sussesfuly created but need to be approved before displaying");
                        $("#Name").val("");
                        $("#Email").val("");
                        $("#comment-text").val("");
                        $("#recaptcha_response_field").val("");
                        $("#RechptchaMessage").empty();
                    }
                },
                error: function (data) {

                },
                type: 'POST',
                dataType: 'json'
            });
        });
    </script>

<!-- begin Pardot Website Tracking code -->
<script type="text/javascript">
piAId = '28442';
piCId = '78324';
(function() {
	function async_load(){
		var s = document.createElement('script'); s.type = 'text/javascript';
		s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
		var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
	}
	if(window.attachEvent) { window.attachEvent('onload', async_load); }
	else { window.addEventListener('load', async_load, false); }
})();
</script>
<!-- end Pardot Website Tracking code -->
<style>    
    .side-list ul {
        list-style-type: none;
        padding: 6px 0px 0px 0px;
        margin: 0px;
    }
    
    
    .side-list ul > li {
        padding: 6px 20px;
        color: #009ed9;
        font-family: 'Lato', Regular;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .side-list ul li:hover, .archiveMonthList li:hover {
        color: #000000;
        background-color: #e3e7e8;
    }
    
    .side-list ul li.active {
        background-color: #e3e7e8;
    }
    
    .side-list ul li.active a {
        color: #000 !important;
    }
</style>
<style>
    .tagcloud {
    padding: 5px 15px 0px 15px !important;
    }
    
    .tagcloud > li {
        padding: 0px 4px;
        color: #009ed9;
        font-family: 'Lato', Regular;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        display: inline;
        line-height: 42px;
    }
    
    .tagcloud > li > a {
        padding: 6px 10px;
        background-color: #caefff;
        color: #009ed9;
        text-decoration: none;
        font-family: 'Lato', Regular;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        line-height: 39px;
    }
    
    .tagcloud > li > a:hover {
        color: #000000;
    }
</style>
<style>
    .archiveMonthList {
        list-style-type: none;
        margin: 0px;
        padding: 6px 0px 0px 0px;
    }

    .archiveMonthList li {
        padding: 6px 20px;
        color: #009ed9;
        font-family: 'Lato', Regular;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .archiveMonthList > li > a {
        color: #009ed9;
        text-decoration: none;
    }
    
    .archiveMonthList > li:hover > a {
        color: #000000;
    }
</style>
<script type="text/javascript" src="./NServiceBus V4.0 release notes_files/contact.js">
</script>

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type="text/javascript">
var _vwo_code=(function(){
var account_id=48133,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

    
    <script type="text/javascript">
        //<![CDATA[

        //search
        $('.search-button').hover(function () {
            $('.search-button img').attr('src', "/Themes/ParticularSoftware/Styles/images/search-active.png");
        }, function () {
            $('.search-button img').attr('src', "/Themes/ParticularSoftware/Styles/images/search.png");
        });

        //redirect

        $('.menu a[href*="/redirect"]').attr("target", "_blank");
        //]]>
    </script>



</div></body></html>